# AGENTS.md (managed)

These instructions are generated by `sdd-workflow-kit` and are intended for AI agents and humans.

## At the Start of ANY Work Session (MANDATORY)

1. Read `{{memory_bank_root}}/README.md` completely.
2. Follow its mandatory reading sequence:
   - `{{memory_bank_root}}/tech_stack.md`
   - `{{memory_bank_root}}/guides/coding_standards.md`
   - `{{memory_bank_root}}/current_tasks.md`
3. Pick the right workflow doc for the task type:
   - New feature: `{{memory_bank_root}}/workflows/new_feature.md`
   - Bug fix: `{{memory_bank_root}}/workflows/bug_fix.md`
   - Code review: `{{memory_bank_root}}/workflows/code_review.md`
   - Refactor: `{{memory_bank_root}}/workflows/refactoring.md`

If the Memory Bank is missing or incomplete, bootstrap it first via this kit and treat that work as a work item.

## Project

- Name: `{{project_name}}`
- Integration branch: `{{integration_branch}}`
- Upstream base (if any): `{{upstream_project}}`

## Communication Language

- Keep this `AGENTS.md` file in English.
- For user-facing communication, use the configured locale from `.sddkit/config.toml` (`[sddkit].locale` = `{{configured_locale}}`).

## Fork / Upstream Sync Discipline (if this repo is a fork)

Goal: keep the diff small to minimize conflicts with upstream updates.

- Prefer additive changes (new files/modules) over editing upstream-owned files.
- If an upstream-owned file must be edited: keep diffs minimal and avoid formatting churn.
- Document upstream impact in the work item spec when non-trivial.
- See: `{{memory_bank_root}}/guides/upstream_sync.md`

## Self-Documentation (No-Conflict Task Updates)

Do not edit the shared task list on feature branches.

- Rules: `{{memory_bank_root}}/guides/task_updates.md`
- Work item specs (one per change): `{{memory_bank_root}}/specs/work_items/`
- Branch updates (append-only): `{{memory_bank_root}}/branch_updates/`

## SDD (Spec-Driven Development)

- SDD root: `{{meta_sdd_root}}`
- Specs: `{{meta_sdd_root}}/specs/{pending,active,completed}/`
- Schema cache: `{{meta_sdd_root}}/schema/`
- Always use wrapper: `{{meta_tools_root}}/sdd ...`

## Dependencies (Freshness Policy)

- Before adding/updating a dependency, verify the latest stable version and compatibility with current stack.
- Prefer latest stable compatible versions by default.
- If an older version is required, document the reason in the work item spec and PR.
- If usage is unclear, consult official online docs/changelog first and follow primary-source guidance.

## Version Pinning Policy

- For server-side module/tool updates, always pin an explicit version (release tag or commit SHA).
- Do not use floating refs in production/server configs (`latest`, `main`, wildcard ranges).
- Every update PR must document: previous version, new version, rollback steps.

## Git Workflow Principles

- Before starting any implementation, create a dedicated branch and switch to it.
- Branch name must reflect the work scope (for example: `feature/<short-slug>`, `fix/<short-slug>`, `chore/<short-slug>`).
- Use one branch per logical change.
- Keep commits atomic and scoped to one purpose.
- Rebase/sync with `{{integration_branch}}` before merge.
- Never force-push to protected/shared branches.

## Commit Message Standard

- Use Conventional Commits: `type(scope): summary`.
- Write summary in imperative mood and keep it concise.
- In commit body, explain why, what changed, and impact/risk.
- Reference issue/spec/work item when relevant.

## Pull Request Standard

- Include: context/problem, solution summary, validation steps, and risks/rollback.
- Keep PR scope focused (no unrelated changes).
- Attach screenshots/logs/examples for UX/API changes when helpful.
- Ensure CI and required checks pass before requesting review.

## Handling PR Review Comments

- Respond to every substantive comment.
- For fixes: push code changes and reply with a short resolution note.
- For disagreements: provide rationale and propose an alternative.
- Resolve comment threads only after the issue is addressed or reviewer alignment is reached.

## Type Safety

- All new/modified functions must have type hints.
- Avoid `Any` in type hints; use concrete types.

## Async I/O

- Do not block the event loop (no sync HTTP in async functions).
- Prefer async http clients (e.g. `httpx.AsyncClient`) and async DB patterns used in the repo.

## Error Handling & Logging

- Follow `{{memory_bank_root}}/patterns/error_handling.md`.
- Prefer standard `logging` (routed into Loguru if configured by the repo).
- Never log secrets.

## Testing (Docker-first when Compose exists)

If the repository is Docker Compose-first, prefer running tests via compose wrappers documented in:

- `{{memory_bank_root}}/guides/testing_strategy.md`
- `{{memory_bank_root}}/guides/assistant_tooling.md`

## Kit usage

- Bootstrap: `python3 {{kit_path}}/bin/sdd-kit bootstrap --project .`
- Sync: `python3 {{kit_path}}/bin/sdd-kit sync --project .`
- Check: `python3 {{kit_path}}/bin/sdd-kit check --project .`

## Skills

Skills live under `{{codex_home}}/skills` (global) or `.codex/skills` (project-local).

Install skills from this kit:

- Global: `python3 {{kit_path}}/bin/sdd-kit install-skills --project . --to global`
- Project: `python3 {{kit_path}}/bin/sdd-kit install-skills --project . --to project`

### Available skills
{{skills_block}}

## Local overrides (safe)

Do not edit managed files directly. Put repo-specific notes into:

- `.sddkit/fragments/AGENTS.append.md`
